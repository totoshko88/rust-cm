app-id: io.github.totoshko88.RustConn
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  - org.freedesktop.Sdk.Extension.llvm19
command: rustconn

finish-args:
  # Wayland/X11 access
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  # Network access for SSH/RDP/VNC/SPICE connections
  - --share=network
  # Home directory access for SSH keys (requires linter exception)
  - --filesystem=home/.ssh:ro
  # D-Bus access for libsecret (credential storage)
  - --talk-name=org.freedesktop.secrets
  # SSH agent socket (requires linter exception)
  - --socket=ssh-auth

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin:/usr/lib/sdk/llvm19/bin
  prepend-ld-library-path: /usr/lib/sdk/llvm19/lib
  env:
    CARGO_HOME: /run/build/rustconn/cargo
    RUST_BACKTRACE: '1'

modules:
  - name: rustconn
    buildsystem: simple
    build-options:
      env:
        CARGO_NET_OFFLINE: 'true'
    build-commands:
      - cargo build --release -p rustconn -p rustconn-cli
      - install -Dm755 target/release/rustconn /app/bin/rustconn
      - install -Dm755 target/release/rustconn-cli /app/bin/rustconn-cli
      - install -Dm644 rustconn/assets/io.github.totoshko88.RustConn.desktop /app/share/applications/io.github.totoshko88.RustConn.desktop
      - install -Dm644 rustconn/assets/io.github.totoshko88.RustConn.metainfo.xml /app/share/metainfo/io.github.totoshko88.RustConn.metainfo.xml
      - install -Dm644 rustconn/assets/icons/hicolor/scalable/apps/io.github.totoshko88.RustConn.svg /app/share/icons/hicolor/scalable/apps/io.github.totoshko88.RustConn.svg
    sources:
      - type: git
        url: https://github.com/totoshko88/rust-cm.git
        tag: v0.4.0
      # Generated with: flatpak-cargo-generator Cargo.lock -o cargo-sources.json
      - cargo-sources.json
